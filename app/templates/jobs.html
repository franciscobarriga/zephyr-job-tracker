{% extends "base.html" %}

{% block title %}Job Board - Zephyr{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h1 class="mb-0"><i class="bi bi-layout-text-sidebar-reverse"></i> Job Board</h1>
    </div>
    <a href="/dashboard" class="btn btn-zephyr-secondary">
        <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
    </a>
</div>

<!-- Filter Tabs -->
<div class="card mb-4">
    <div class="card-body py-2">
        <div class="d-flex flex-wrap gap-2 align-items-center">
            <span class="text-muted me-2"><i class="bi bi-filter me-1"></i>Filter:</span>
            <a href="/job-board" class="btn btn-sm {% if not status_filter or status_filter == 'all' %}btn-zephyr{% else %}btn-zephyr-secondary{% endif %}">
                All <span class="badge bg-light text-dark ms-1">{{ stats.new + stats.thinking + stats.ignored }}</span>
            </a>
            <a href="/job-board?status_filter=New" class="btn btn-sm {% if status_filter == 'New' %}btn-zephyr{% else %}btn-zephyr-secondary{% endif %}">
                <i class="bi bi-stars me-1"></i>New <span class="badge bg-light text-dark ms-1">{{ stats.new }}</span>
            </a>
            <a href="/job-board?status_filter=Thinking" class="btn btn-sm {% if status_filter == 'Thinking' %}btn-zephyr{% else %}btn-zephyr-secondary{% endif %}">
                <i class="bi bi-hourglass-split me-1"></i>Thinking <span class="badge bg-light text-dark ms-1">{{ stats.thinking }}</span>
            </a>
            <a href="/job-board?status_filter=Ignored" class="btn btn-sm {% if status_filter == 'Ignored' %}btn-zephyr{% else %}btn-zephyr-secondary{% endif %}">
                <i class="bi bi-x-circle me-1"></i>Ignored <span class="badge bg-light text-dark ms-1">{{ stats.ignored }}</span>
            </a>
            <span class="ms-auto text-muted small">
                <i class="bi bi-info-circle me-1"></i>Applied jobs shown in Dashboard
            </span>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body p-0">
        {% if jobs %}
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="jobsTable">
                <thead>
                    <tr>
                        <th style="width: 40px;"></th>
                        <th>Position</th>
                        <th>Company</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th style="width: 180px;"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in jobs %}
                    <tr class="job-row" data-job-id="{{ job.id }}" onclick="toggleJobDetails('{{ job.id }}')" style="cursor: pointer;">
                        <td>
                            <i class="bi bi-chevron-right expand-icon" id="icon-{{ job.id }}"></i>
                        </td>
                        <td>
                            <strong>{{ job.title }}</strong>
                            {% if job.ai_requirements %}
                            <br><small class="text-muted">{{ job.ai_requirements[:80] }}{% if job.ai_requirements|length > 80 %}...{% endif %}</small>
                            {% endif %}
                        </td>
                        <td>{{ job.company }}</td>
                        <td>
                            {% if job.location %}
                            <i class="bi bi-geo-alt me-1 text-muted"></i>{{ job.location }}
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td onclick="event.stopPropagation()">
                            {% set status = job.status or 'New' %}
                            {% if status == 'Applied' %}
                                <span class="badge badge-status badge-applied">
                                    <i class="bi bi-check-circle me-1"></i>Applied
                                </span>
                            {% elif status == 'Thinking' %}
                                <span class="badge badge-status badge-thinking">
                                    <i class="bi bi-hourglass-split me-1"></i>Thinking
                                </span>
                            {% elif status == 'Ignored' %}
                                <span class="badge badge-status badge-ignored">
                                    <i class="bi bi-x-circle me-1"></i>Ignored
                                </span>
                            {% else %}
                                <span class="badge badge-status badge-new">
                                    <i class="bi bi-stars me-1"></i>New
                                </span>
                            {% endif %}
                        </td>
                        <td onclick="event.stopPropagation()">
                            <div class="d-flex gap-2">
                                <div class="btn-group btn-group-sm" role="group" aria-label="Status actions">
                                    <form method="POST" action="/job-board/{{ job.id }}/update-status" style="display: inline;">
                                        <input type="hidden" name="status" value="Applied">
                                        <button type="submit" class="btn {% if status == 'Applied' %}btn-success{% else %}btn-outline-success{% endif %}" title="Mark as Applied" {% if status == 'Applied' %}disabled{% endif %}>
                                            <i class="bi bi-check-lg"></i>
                                        </button>
                                    </form>
                                    <form method="POST" action="/job-board/{{ job.id }}/update-status" style="display: inline;">
                                        <input type="hidden" name="status" value="Thinking">
                                        <button type="submit" class="btn {% if status == 'Thinking' %}btn-warning text-dark{% else %}btn-outline-warning{% endif %}" title="Mark as Thinking" {% if status == 'Thinking' %}disabled{% endif %}>
                                            <i class="bi bi-hourglass"></i>
                                        </button>
                                    </form>
                                    <form method="POST" action="/job-board/{{ job.id }}/update-status" style="display: inline;">
                                        <input type="hidden" name="status" value="Ignored">
                                        <button type="submit" class="btn {% if status == 'Ignored' %}btn-secondary{% else %}btn-outline-secondary{% endif %}" title="Mark as Ignored" {% if status == 'Ignored' %}disabled{% endif %}>
                                            <i class="bi bi-x-lg"></i>
                                        </button>
                                    </form>
                                </div>
                                {% if job.url %}
                                <a href="{{ job.url }}" target="_blank" class="btn btn-sm btn-outline-primary" title="View Job">
                                    <i class="bi bi-box-arrow-up-right"></i>
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    <!-- Hidden details row -->
                    <tr id="details-{{ job.id }}" class="job-details-row" style="display: none;">
                        <td colspan="6">
                            <div class="p-3 bg-light rounded">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6><i class="bi bi-robot me-2"></i>AI Summary</h6>
                                        <p class="mb-3">{{ job.ai_summary if job.ai_summary else 'No summary available' }}</p>

                                        <h6><i class="bi bi-tools me-2"></i>Requirements</h6>
                                        <p class="mb-3">{{ job.ai_requirements if job.ai_requirements else 'No requirements extracted' }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="bi bi-info-circle me-2"></i>Job Details</h6>
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td><strong>Job Type:</strong></td>
                                                <td>{{ job.job_type if job.job_type else '-' }}</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Experience:</strong></td>
                                                <td>{{ job.experience_level if job.experience_level else '-' }}</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Work Type:</strong></td>
                                                <td>{{ job.work_type if job.work_type else '-' }}</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Posted:</strong></td>
                                                <td>{{ job.posted_date[:10] if job.posted_date else job.created_at[:10] if job.created_at else '-' }}</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Applicants:</strong></td>
                                                <td>{{ job.applicants_count if job.applicants_count else '-' }}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card-footer bg-transparent">
            <span class="text-muted">
                Showing {{ jobs|length }} jobs - Click on a row to see details
            </span>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-briefcase" style="font-size: 4rem; color: var(--zephyr-foam);"></i>
            <h4 class="mt-3">No jobs in board</h4>
            <p class="text-muted">
                {% if status_filter %}
                No jobs with status "{{ status_filter }}". Try another filter or
                {% endif %}
                The scraper will find new jobs for you!
            </p>
            <a href="/search" class="btn btn-zephyr mt-2">
                <i class="bi bi-plus-lg me-2"></i>Create Search Config
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
function toggleJobDetails(jobId) {
    var detailsRow = document.getElementById('details-' + jobId);
    var icon = document.getElementById('icon-' + jobId);

    if (detailsRow.style.display === 'none') {
        detailsRow.style.display = 'table-row';
        icon.classList.remove('bi-chevron-right');
        icon.classList.add('bi-chevron-down');
    } else {
        detailsRow.style.display = 'none';
        icon.classList.remove('bi-chevron-down');
        icon.classList.add('bi-chevron-right');
    }
}
</script>

<style>
    .btn-success {
        background-color: #10B981;
        border-color: #10B981;
    }

    .btn-success:hover, .btn-success:focus {
        background-color: #059669;
        border-color: #059669;
    }

    .btn-success:disabled {
        opacity: 1;
    }

    .btn-outline-success {
        border-color: #10B981;
        color: #10B981;
    }

    .btn-outline-success:hover {
        background-color: #10B981;
        border-color: #10B981;
        color: white;
    }

    .btn-warning {
        background-color: #F59E0B;
        border-color: #F59E0B;
        color: white;
    }

    .btn-warning:hover, .btn-warning:focus {
        background-color: #D97706;
        border-color: #D97706;
        color: white;
    }

    .btn-warning:disabled {
        opacity: 1;
    }

    .btn-outline-warning {
        border-color: #F59E0B;
        color: #F59E0B;
    }

    .btn-outline-warning:hover {
        background-color: #F59E0B;
        border-color: #F59E0B;
        color: white;
    }

    .btn-outline-secondary {
        border-color: var(--border);
        color: var(--text-secondary);
    }

    .btn-outline-secondary:hover {
        background: var(--zephyr-foam);
        border-color: var(--zephyr-breeze);
        color: var(--zephyr-deep);
    }

    .btn-outline-primary {
        border-color: var(--zephyr-breeze);
        color: var(--zephyr-breeze);
    }

    .btn-outline-primary:hover {
        background: var(--zephyr-breeze);
        border-color: var(--zephyr-breeze);
        color: white;
    }

    .job-row:hover {
        background-color: #f8f9fa;
    }

    .job-details-row td {
        padding: 0 !important;
    }

    .expand-icon {
        transition: transform 0.2s ease;
    }

    /* Mobile App-Like Styles */
    @media (max-width: 768px) {
        /* Hide table headers on mobile */
        #jobsTable thead {
            display: none;
        }

        /* Card-style rows on mobile */
        #jobsTable tbody tr.job-row {
            display: block;
            background: white;
            border-radius: 12px;
            margin: 0 0 0.75rem 0;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        #jobsTable tbody td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            border: none;
            border-bottom: 1px solid #f5f5f5;
        }

        #jobsTable tbody td:last-child {
            border-bottom: none;
            padding-top: 0.75rem;
            justify-content: flex-end;
        }

        #jobsTable td:nth-child(1):before { content: ''; display: none; }
        #jobsTable td:nth-child(2):before { content: 'Position'; }
        #jobsTable td:nth-child(3):before { content: 'Company'; }
        #jobsTable td:nth-child(4):before { content: 'Location'; }
        #jobsTable td:nth-child(5):before { content: 'Status'; }
        #jobsTable td:nth-child(6):before { content: ''; }

        #jobsTable td::before {
            content: attr(data-label);
            font-weight: 600;
            color: #6c757d;
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-right: 1rem;
        }

        /* Expanded details */
        #jobsTable .job-details-row td {
            display: block;
            padding: 0 !important;
        }

        #jobsTable .job-details-row .p-3 {
            margin: 0.5rem 0 0 0;
            border-radius: 12px;
        }

        /* Larger touch targets */
        .btn-group-sm .btn {
            min-width: 44px;
            min-height: 44px;
        }

        /* Filter tabs - horizontal scroll */
        .card-body.py-2 .d-flex {
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 0.5rem;
        }

        .card-body.py-2 .d-flex .btn {
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* Hide applied count on mobile filter */
        .card-body.py-2 .badge {
            display: none;
        }
    }
</style>
{% endblock %}
